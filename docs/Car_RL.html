---

title: Car RL


keywords: fastai
sidebar: home_sidebar



nb_path: "00_Car_RL.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_Car_RL.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">bfh_mt_hs2020_rl_basics.env</span> <span class="kn">import</span> <span class="n">CarEnv</span>
<span class="kn">from</span> <span class="nn">bfh_mt_hs2020_rl_basics.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">bfh_mt_hs2020_rl_basics.bridge</span> <span class="kn">import</span> <span class="n">Bridge</span>
<span class="kn">from</span> <span class="nn">bfh_mt_hs2020_rl_basics.loop</span> <span class="kn">import</span> <span class="n">LoopControl</span>

<span class="kn">import</span> <span class="nn">gym</span>
<span class="kn">from</span> <span class="nn">gym.spaces</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Discrete</span><span class="p">,</span> <span class="n">Box</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">torch</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_control</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoopControl</span><span class="p">:</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CarEnv</span><span class="p">()</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">bridge</span> <span class="o">=</span> <span class="n">Bridge</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">)</span>
    <span class="n">control</span> <span class="o">=</span> <span class="n">LoopControl</span><span class="p">(</span><span class="n">bridge</span><span class="o">=</span><span class="n">bridge</span><span class="p">,</span> <span class="n">run_name</span><span class="o">=</span><span class="n">run_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">control</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">run_example</span><span class="p">():</span>
    <span class="c1"># get rid of missing metrics warning</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
    
    <span class="n">control</span> <span class="o">=</span> <span class="n">create_control</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">),</span> <span class="s2">&quot;Demo&quot;</span><span class="p">)</span>
    <span class="n">control</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run_example</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-23-74f950931a63&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 1</span><span class="ansi-yellow-intense-fg ansi-bold"> </span>run_example<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-22-772442a43a54&gt;</span> in <span class="ansi-cyan-fg">run_example</span><span class="ansi-blue-intense-fg ansi-bold">()</span>
<span class="ansi-green-fg">      3</span>     warnings<span class="ansi-yellow-intense-fg ansi-bold">.</span>simplefilter<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#34;ignore&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> category<span class="ansi-yellow-intense-fg ansi-bold">=</span>UserWarning<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      4</span> 
<span class="ansi-green-intense-fg ansi-bold">----&gt; 5</span><span class="ansi-yellow-intense-fg ansi-bold">     </span>control <span class="ansi-yellow-intense-fg ansi-bold">=</span> create_control<span class="ansi-yellow-intense-fg ansi-bold">(</span>torch<span class="ansi-yellow-intense-fg ansi-bold">.</span>device<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#34;cuda&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#34;Demo&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      6</span>     control<span class="ansi-yellow-intense-fg ansi-bold">.</span>run<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-19-f1bfb2e948b3&gt;</span> in <span class="ansi-cyan-fg">create_control</span><span class="ansi-blue-intense-fg ansi-bold">(device, run_name)</span>
<span class="ansi-green-fg">      1</span> <span class="ansi-green-intense-fg ansi-bold">def</span> create_control<span class="ansi-yellow-intense-fg ansi-bold">(</span>device<span class="ansi-yellow-intense-fg ansi-bold">,</span> run_name<span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">-&gt;</span> LoopControl<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">      2</span>     env <span class="ansi-yellow-intense-fg ansi-bold">=</span> CarEnv<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 3</span><span class="ansi-yellow-intense-fg ansi-bold">     </span>agent <span class="ansi-yellow-intense-fg ansi-bold">=</span> Agent<span class="ansi-yellow-intense-fg ansi-bold">(</span>env<span class="ansi-yellow-intense-fg ansi-bold">,</span> device <span class="ansi-yellow-intense-fg ansi-bold">=</span> device<span class="ansi-yellow-intense-fg ansi-bold">,</span> gamma<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">0.9</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> buffer_size<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1000</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      4</span>     bridge <span class="ansi-yellow-intense-fg ansi-bold">=</span> Bridge<span class="ansi-yellow-intense-fg ansi-bold">(</span>agent<span class="ansi-yellow-intense-fg ansi-bold">=</span>agent<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">      5</span>     control <span class="ansi-yellow-intense-fg ansi-bold">=</span> LoopControl<span class="ansi-yellow-intense-fg ansi-bold">(</span>bridge<span class="ansi-yellow-intense-fg ansi-bold">=</span>bridge<span class="ansi-yellow-intense-fg ansi-bold">,</span> run_name<span class="ansi-yellow-intense-fg ansi-bold">=</span>run_name<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\projects\bfh_mt_hs2020_rl_basics\bfh_mt_hs2020_rl_basics\agent.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-intense-fg ansi-bold">(self, env, device, gamma, buffer_size, eps_start, eps_final, eps_frames, target_net_sync)</span>
<span class="ansi-green-fg">     35</span>         self<span class="ansi-yellow-intense-fg ansi-bold">.</span>target_net_sync <span class="ansi-yellow-intense-fg ansi-bold">=</span> target_net_sync
<span class="ansi-green-fg">     36</span> 
<span class="ansi-green-intense-fg ansi-bold">---&gt; 37</span><span class="ansi-yellow-intense-fg ansi-bold">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>net <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_config_net<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     38</span> 
<span class="ansi-green-fg">     39</span>         self<span class="ansi-yellow-intense-fg ansi-bold">.</span>tgt_net <span class="ansi-yellow-intense-fg ansi-bold">=</span> ptan<span class="ansi-yellow-intense-fg ansi-bold">.</span>agent<span class="ansi-yellow-intense-fg ansi-bold">.</span>TargetNet<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>net<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\projects\bfh_mt_hs2020_rl_basics\bfh_mt_hs2020_rl_basics\agent.py</span> in <span class="ansi-cyan-fg">_config_net</span><span class="ansi-blue-intense-fg ansi-bold">(self)</span>
<span class="ansi-green-fg">     52</span> 
<span class="ansi-green-fg">     53</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> _config_net<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">-&gt;</span> nn<span class="ansi-yellow-intense-fg ansi-bold">.</span>Module<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 54</span><span class="ansi-yellow-intense-fg ansi-bold">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> Net<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>env<span class="ansi-yellow-intense-fg ansi-bold">.</span>observation_space<span class="ansi-yellow-intense-fg ansi-bold">.</span>shape<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-cyan-intense-fg ansi-bold">0</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-cyan-intense-fg ansi-bold">128</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>env<span class="ansi-yellow-intense-fg ansi-bold">.</span>action_space<span class="ansi-yellow-intense-fg ansi-bold">.</span>n<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>to<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>device<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     55</span> 
<span class="ansi-green-fg">     56</span> 

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">to</span><span class="ansi-blue-intense-fg ansi-bold">(self, *args, **kwargs)</span>
<span class="ansi-green-fg">    605</span>             <span class="ansi-green-intense-fg ansi-bold">return</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>to<span class="ansi-yellow-intense-fg ansi-bold">(</span>device<span class="ansi-yellow-intense-fg ansi-bold">,</span> dtype <span class="ansi-green-intense-fg ansi-bold">if</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>is_floating_point<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">else</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> non_blocking<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    606</span> 
<span class="ansi-green-intense-fg ansi-bold">--&gt; 607</span><span class="ansi-yellow-intense-fg ansi-bold">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>convert<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    608</span> 
<span class="ansi-green-fg">    609</span>     def register_backward_hook(

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">_apply</span><span class="ansi-blue-intense-fg ansi-bold">(self, fn)</span>
<span class="ansi-green-fg">    352</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> _apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> fn<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">    353</span>         <span class="ansi-green-intense-fg ansi-bold">for</span> module <span class="ansi-green-intense-fg ansi-bold">in</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>children<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 354</span><span class="ansi-yellow-intense-fg ansi-bold">             </span>module<span class="ansi-yellow-intense-fg ansi-bold">.</span>_apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>fn<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    355</span> 
<span class="ansi-green-fg">    356</span>         <span class="ansi-green-intense-fg ansi-bold">def</span> compute_should_use_set_data<span class="ansi-yellow-intense-fg ansi-bold">(</span>tensor<span class="ansi-yellow-intense-fg ansi-bold">,</span> tensor_applied<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">_apply</span><span class="ansi-blue-intense-fg ansi-bold">(self, fn)</span>
<span class="ansi-green-fg">    352</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> _apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> fn<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">    353</span>         <span class="ansi-green-intense-fg ansi-bold">for</span> module <span class="ansi-green-intense-fg ansi-bold">in</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>children<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 354</span><span class="ansi-yellow-intense-fg ansi-bold">             </span>module<span class="ansi-yellow-intense-fg ansi-bold">.</span>_apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>fn<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    355</span> 
<span class="ansi-green-fg">    356</span>         <span class="ansi-green-intense-fg ansi-bold">def</span> compute_should_use_set_data<span class="ansi-yellow-intense-fg ansi-bold">(</span>tensor<span class="ansi-yellow-intense-fg ansi-bold">,</span> tensor_applied<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">_apply</span><span class="ansi-blue-intense-fg ansi-bold">(self, fn)</span>
<span class="ansi-green-fg">    374</span>                 <span class="ansi-red-intense-fg ansi-bold"># `with torch.no_grad():`</span>
<span class="ansi-green-fg">    375</span>                 <span class="ansi-green-intense-fg ansi-bold">with</span> torch<span class="ansi-yellow-intense-fg ansi-bold">.</span>no_grad<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 376</span><span class="ansi-yellow-intense-fg ansi-bold">                     </span>param_applied <span class="ansi-yellow-intense-fg ansi-bold">=</span> fn<span class="ansi-yellow-intense-fg ansi-bold">(</span>param<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    377</span>                 should_use_set_data <span class="ansi-yellow-intense-fg ansi-bold">=</span> compute_should_use_set_data<span class="ansi-yellow-intense-fg ansi-bold">(</span>param<span class="ansi-yellow-intense-fg ansi-bold">,</span> param_applied<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    378</span>                 <span class="ansi-green-intense-fg ansi-bold">if</span> should_use_set_data<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">convert</span><span class="ansi-blue-intense-fg ansi-bold">(t)</span>
<span class="ansi-green-fg">    603</span>             <span class="ansi-green-intense-fg ansi-bold">if</span> convert_to_format <span class="ansi-green-intense-fg ansi-bold">is</span> <span class="ansi-green-intense-fg ansi-bold">not</span> <span class="ansi-green-intense-fg ansi-bold">None</span> <span class="ansi-green-intense-fg ansi-bold">and</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>dim<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-cyan-intense-fg ansi-bold">4</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">    604</span>                 <span class="ansi-green-intense-fg ansi-bold">return</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>to<span class="ansi-yellow-intense-fg ansi-bold">(</span>device<span class="ansi-yellow-intense-fg ansi-bold">,</span> dtype <span class="ansi-green-intense-fg ansi-bold">if</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>is_floating_point<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">else</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> non_blocking<span class="ansi-yellow-intense-fg ansi-bold">,</span> memory_format<span class="ansi-yellow-intense-fg ansi-bold">=</span>convert_to_format<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 605</span><span class="ansi-yellow-intense-fg ansi-bold">             </span><span class="ansi-green-intense-fg ansi-bold">return</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>to<span class="ansi-yellow-intense-fg ansi-bold">(</span>device<span class="ansi-yellow-intense-fg ansi-bold">,</span> dtype <span class="ansi-green-intense-fg ansi-bold">if</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>is_floating_point<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">else</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> non_blocking<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    606</span> 
<span class="ansi-green-fg">    607</span>         <span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>convert<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-intense-fg ansi-bold">RuntimeError</span>: CUDA error: an illegal memory access was encountered</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">CarEnv</span><span class="p">()</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">),</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-28-7329dc4603b1&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">      1</span> env <span class="ansi-yellow-intense-fg ansi-bold">=</span> CarEnv<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 2</span><span class="ansi-yellow-intense-fg ansi-bold"> </span>agent <span class="ansi-yellow-intense-fg ansi-bold">=</span> Agent<span class="ansi-yellow-intense-fg ansi-bold">(</span>env<span class="ansi-yellow-intense-fg ansi-bold">,</span> device <span class="ansi-yellow-intense-fg ansi-bold">=</span> torch<span class="ansi-yellow-intense-fg ansi-bold">.</span>device<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#34;cuda&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> gamma<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">0.9</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> buffer_size<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-cyan-intense-fg ansi-bold">1000</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\projects\bfh_mt_hs2020_rl_basics\bfh_mt_hs2020_rl_basics\agent.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-intense-fg ansi-bold">(self, env, device, gamma, buffer_size, eps_start, eps_final, eps_frames, target_net_sync)</span>
<span class="ansi-green-fg">     35</span>         self<span class="ansi-yellow-intense-fg ansi-bold">.</span>target_net_sync <span class="ansi-yellow-intense-fg ansi-bold">=</span> target_net_sync
<span class="ansi-green-fg">     36</span> 
<span class="ansi-green-intense-fg ansi-bold">---&gt; 37</span><span class="ansi-yellow-intense-fg ansi-bold">         </span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>net <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_config_net<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     38</span> 
<span class="ansi-green-fg">     39</span>         self<span class="ansi-yellow-intense-fg ansi-bold">.</span>tgt_net <span class="ansi-yellow-intense-fg ansi-bold">=</span> ptan<span class="ansi-yellow-intense-fg ansi-bold">.</span>agent<span class="ansi-yellow-intense-fg ansi-bold">.</span>TargetNet<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>net<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\projects\bfh_mt_hs2020_rl_basics\bfh_mt_hs2020_rl_basics\agent.py</span> in <span class="ansi-cyan-fg">_config_net</span><span class="ansi-blue-intense-fg ansi-bold">(self)</span>
<span class="ansi-green-fg">     52</span> 
<span class="ansi-green-fg">     53</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> _config_net<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">-&gt;</span> nn<span class="ansi-yellow-intense-fg ansi-bold">.</span>Module<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 54</span><span class="ansi-yellow-intense-fg ansi-bold">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> Net<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>env<span class="ansi-yellow-intense-fg ansi-bold">.</span>observation_space<span class="ansi-yellow-intense-fg ansi-bold">.</span>shape<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-cyan-intense-fg ansi-bold">0</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-cyan-intense-fg ansi-bold">128</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>env<span class="ansi-yellow-intense-fg ansi-bold">.</span>action_space<span class="ansi-yellow-intense-fg ansi-bold">.</span>n<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>to<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">.</span>device<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     55</span> 
<span class="ansi-green-fg">     56</span> 

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">to</span><span class="ansi-blue-intense-fg ansi-bold">(self, *args, **kwargs)</span>
<span class="ansi-green-fg">    605</span>             <span class="ansi-green-intense-fg ansi-bold">return</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>to<span class="ansi-yellow-intense-fg ansi-bold">(</span>device<span class="ansi-yellow-intense-fg ansi-bold">,</span> dtype <span class="ansi-green-intense-fg ansi-bold">if</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>is_floating_point<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">else</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> non_blocking<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    606</span> 
<span class="ansi-green-intense-fg ansi-bold">--&gt; 607</span><span class="ansi-yellow-intense-fg ansi-bold">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>convert<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    608</span> 
<span class="ansi-green-fg">    609</span>     def register_backward_hook(

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">_apply</span><span class="ansi-blue-intense-fg ansi-bold">(self, fn)</span>
<span class="ansi-green-fg">    352</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> _apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> fn<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">    353</span>         <span class="ansi-green-intense-fg ansi-bold">for</span> module <span class="ansi-green-intense-fg ansi-bold">in</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>children<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 354</span><span class="ansi-yellow-intense-fg ansi-bold">             </span>module<span class="ansi-yellow-intense-fg ansi-bold">.</span>_apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>fn<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    355</span> 
<span class="ansi-green-fg">    356</span>         <span class="ansi-green-intense-fg ansi-bold">def</span> compute_should_use_set_data<span class="ansi-yellow-intense-fg ansi-bold">(</span>tensor<span class="ansi-yellow-intense-fg ansi-bold">,</span> tensor_applied<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">_apply</span><span class="ansi-blue-intense-fg ansi-bold">(self, fn)</span>
<span class="ansi-green-fg">    352</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> _apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> fn<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">    353</span>         <span class="ansi-green-intense-fg ansi-bold">for</span> module <span class="ansi-green-intense-fg ansi-bold">in</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>children<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 354</span><span class="ansi-yellow-intense-fg ansi-bold">             </span>module<span class="ansi-yellow-intense-fg ansi-bold">.</span>_apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>fn<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    355</span> 
<span class="ansi-green-fg">    356</span>         <span class="ansi-green-intense-fg ansi-bold">def</span> compute_should_use_set_data<span class="ansi-yellow-intense-fg ansi-bold">(</span>tensor<span class="ansi-yellow-intense-fg ansi-bold">,</span> tensor_applied<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">_apply</span><span class="ansi-blue-intense-fg ansi-bold">(self, fn)</span>
<span class="ansi-green-fg">    374</span>                 <span class="ansi-red-intense-fg ansi-bold"># `with torch.no_grad():`</span>
<span class="ansi-green-fg">    375</span>                 <span class="ansi-green-intense-fg ansi-bold">with</span> torch<span class="ansi-yellow-intense-fg ansi-bold">.</span>no_grad<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 376</span><span class="ansi-yellow-intense-fg ansi-bold">                     </span>param_applied <span class="ansi-yellow-intense-fg ansi-bold">=</span> fn<span class="ansi-yellow-intense-fg ansi-bold">(</span>param<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    377</span>                 should_use_set_data <span class="ansi-yellow-intense-fg ansi-bold">=</span> compute_should_use_set_data<span class="ansi-yellow-intense-fg ansi-bold">(</span>param<span class="ansi-yellow-intense-fg ansi-bold">,</span> param_applied<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    378</span>                 <span class="ansi-green-intense-fg ansi-bold">if</span> should_use_set_data<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-intense-fg ansi-bold">C:\ieu\Anaconda3\envs\deep_rl_hands_on\lib\site-packages\torch\nn\modules\module.py</span> in <span class="ansi-cyan-fg">convert</span><span class="ansi-blue-intense-fg ansi-bold">(t)</span>
<span class="ansi-green-fg">    603</span>             <span class="ansi-green-intense-fg ansi-bold">if</span> convert_to_format <span class="ansi-green-intense-fg ansi-bold">is</span> <span class="ansi-green-intense-fg ansi-bold">not</span> <span class="ansi-green-intense-fg ansi-bold">None</span> <span class="ansi-green-intense-fg ansi-bold">and</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>dim<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">==</span> <span class="ansi-cyan-intense-fg ansi-bold">4</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">    604</span>                 <span class="ansi-green-intense-fg ansi-bold">return</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>to<span class="ansi-yellow-intense-fg ansi-bold">(</span>device<span class="ansi-yellow-intense-fg ansi-bold">,</span> dtype <span class="ansi-green-intense-fg ansi-bold">if</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>is_floating_point<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">else</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> non_blocking<span class="ansi-yellow-intense-fg ansi-bold">,</span> memory_format<span class="ansi-yellow-intense-fg ansi-bold">=</span>convert_to_format<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 605</span><span class="ansi-yellow-intense-fg ansi-bold">             </span><span class="ansi-green-intense-fg ansi-bold">return</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>to<span class="ansi-yellow-intense-fg ansi-bold">(</span>device<span class="ansi-yellow-intense-fg ansi-bold">,</span> dtype <span class="ansi-green-intense-fg ansi-bold">if</span> t<span class="ansi-yellow-intense-fg ansi-bold">.</span>is_floating_point<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">else</span> <span class="ansi-green-intense-fg ansi-bold">None</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> non_blocking<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    606</span> 
<span class="ansi-green-fg">    607</span>         <span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_apply<span class="ansi-yellow-intense-fg ansi-bold">(</span>convert<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-red-intense-fg ansi-bold">RuntimeError</span>: CUDA error: an illegal memory access was encountered</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

